entrypoint = "main.py"
modules = ["python-3.10:v20-20230824-f46249a"]
hidden = [".pythonlibs"]

[nix]
channel = "stable-23_05"
packages = [
  "cairo",
  "ffmpeg-full",
  "fontconfig",
  "freetype",
  "ghostscript",
  "glib",
  "glibcLocales",
  "gobject-introspection",
  "gtk3",
  "harfbuzz",
  "ipaexfont",
  "pango",
  "pkg-config",
  "python310",
  "python310Packages.pip",
  "qhull",
  "tcl",
  "tk",
]

[[ports]]
localPort = 3000
externalPort = 80

[[ports]]
localPort = 5000
externalPort = 5000

[[ports]]
localPort = 8080
externalPort = 8080

[workflows]
runButton = "Run"

[[workflows.workflow]]
name = "Run"
author = 39887795
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "mkdir -p ~/.fonts && cp -n static/fonts/IPAexGothic.ttf ~/.fonts/ && fc-cache -fv && pip install -r requirements.txt && python main.py"

[deployment]
deploymentTarget = "cloudrun"
run = [
  "sh",
  "-c",
  "mkdir -p ~/.fonts && cp -n static/fonts/IPAexGothic.ttf ~/.fonts/ && fc-cache -fv && pip install -r requirements.txt && echo \"--- Starting Gunicorn ---\" && gunicorn main:app --bind 0.0.0.0:3000 --access-logfile - --error-logfile -",
]
